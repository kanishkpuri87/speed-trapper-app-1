@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    @Scripts.Render("~/bundles/jquery")

    <script src="~/Scripts/jquery.signalR-2.1.2.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="http://localhost:57040/SignalR/hubs"></script>
    <meta name="viewport" content="width=device-width" />
    <title>Speedjoin</title>
</head>
<body>
    <div>
        
        <div id="discussion"></div>
    </div>
</body>
</html>
<script>
    $(function () {
        // Reference the auto-generated proxy for the hub.
        var car = "";
        var carspeed=0;
            $.support.cors = true;
          

        $.connection.hub.url = 'http://localhost:57040/signalr';
        var chat = $.connection.SpeedTrapperHub;
        chat.client.broadcastMessage = function broadcastMessage(name, message, speed) {
            $('#discussion').html("");
            // Add the message to the page.
            if (message == 0)
            { $('#discussion').append('<div  style=" float:left;margin-left:10px;"><span style="font-size:x-large; ">My Name is ' + name + '</span><br />    <span style="font-size:x-large; color:forestgreen">' + speed + 'KM</span><br />    <span style="font-size:x-large; ">(Current Speed)</span></div>'); }

            else { $('#discussion').append('<div  style=" float:left;margin-left:10px;"><span style="font-size:x-large; ">My Name is ' + name + '</span><br />    <span style="font-size:x-large; color:red">You are busted</span><br />    <span style="font-size:x-large; color:red">(Over Speed ' + speed + ')</span></div>'); }
        };
       
        function getNameAndSpeed() {
            $.get('../../resources/car-names.txt', function (data) {
                $.support.cors = true;

                var quotes = data.split("\n");
              
                var idx = Math.floor(quotes.length * Math.random());
                car = quotes[idx-1];

              
                carspeed = Math.floor((Math.random() * 200) + 10);
              
                chat.server.send(car, carspeed);
            });

        }
        
      
        $.connection.hub.start({jsonp:true}).done(function () {
            getNameAndSpeed();
         
        });

        //setInterval(function () {


        //    getNameAndSpeed();
        //}, 10000);
    });

      

    
</script>

